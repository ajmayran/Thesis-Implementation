{% load static %}

<aside class="sidebar" id="sidebar">
    <div class="sidebar-user">
        <div class="user-avatar">
            {{ request.user.first_name.0|default:'U' }}{{ request.user.last_name.0|default:'S' }}
        </div>
        <div class="user-info">
            <div class="user-name">{{ request.user.first_name }} {{ request.user.last_name }}</div>
            <div class="user-email">{{ request.user.email }}</div>
        </div>
    </div>

    <nav class="sidebar-nav">
        <a href="{% url 'dashboard:student_dashboard' %}" class="nav-item {% if request.resolver_match.url_name == 'student_dashboard' %}active{% endif %}" data-color="blue">
            <div class="nav-item-icon">
                <i class="fa-solid fa-house"></i>
            </div>
            <span class="nav-item-text">Dashboard</span>
        </a>
        <a href="{% url 'prediction:student_predict' %}" class="nav-item {% if request.resolver_match.url_name == 'student_predict' %}active{% endif %}" data-color="green">
            <div class="nav-item-icon">
                <i class="fa-solid fa-wand-magic-sparkles"></i>
            </div>
            <span class="nav-item-text">New Prediction</span>
        </a>
        <a href="{% url 'prediction:history' %}" class="nav-item {% if request.resolver_match.url_name == 'history' %}active{% endif %}" data-color="purple">
            <div class="nav-item-icon">
                <i class="fa-solid fa-clock-rotate-left"></i>
            </div>
            <span class="nav-item-text">History</span>
        </a>
        <a href="{% url 'dashboard:student_profile' %}" class="nav-item {% if request.resolver_match.url_name == 'student_profile' %}active{% endif %}" data-color="orange">
            <div class="nav-item-icon">
                <i class="fa-solid fa-user"></i>
            </div>
            <span class="nav-item-text">Profile</span>
        </a>
    </nav>

    <div class="sidebar-logout">
        <a href="{% url 'accounts:logout' %}" class="nav-item logout logout-trigger">
            <div class="nav-item-icon">
                <i class="fa-solid fa-right-from-bracket"></i>
            </div>
            <span class="nav-item-text">Logout</span>
        </a>
    </div>

    <div class="sidebar-footer">
        <div class="footer-badge">
            <i class="fa-solid fa-shield-halved"></i>
            <span>Exam Predictor</span>
        </div>
        <div class="footer-version">v1.0.0</div>
    </div>
</aside>

<!-- Logout Confirmation Modal -->
<div id="logoutModal" class="logout-modal hidden">
    <div class="logout-modal-backdrop"></div>
    <div class="logout-modal-content">
        <div class="logout-modal-header">
            <div class="logout-modal-icon">
                <i class="fa-solid fa-right-from-bracket"></i>
            </div>
            <div>
                <h2>Ready to sign out?</h2>
                <p>Your progress is safe. You can come back anytime.</p>
            </div>
        </div>
        <div class="logout-modal-actions">
            <button type="button" id="cancelLogout" class="btn-secondary">Stay logged in</button>
            <button type="button" id="confirmLogout" class="btn-danger">Log out</button>
        </div>
    </div>
</div>

<div class="sidebar-overlay" id="sidebarOverlay"></div>

<button class="sidebar-toggle" id="sidebarToggle">
    <i class="fa-solid fa-bars"></i>
</button>

<script>
    // Mobile sidebar toggle
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const toggleIcon = sidebarToggle.querySelector('i');

    sidebarToggle.addEventListener('click', function() {
        sidebar.classList.toggle('open');
        sidebarOverlay.classList.toggle('active');
        
        // Toggle icon between bars and X
        if (sidebar.classList.contains('open')) {
            toggleIcon.classList.remove('fa-bars');
            toggleIcon.classList.add('fa-xmark');
        } else {
            toggleIcon.classList.remove('fa-xmark');
            toggleIcon.classList.add('fa-bars');
        }
    });

    sidebarOverlay.addEventListener('click', function() {
        sidebar.classList.remove('open');
        sidebarOverlay.classList.remove('active');
        toggleIcon.classList.remove('fa-xmark');
        toggleIcon.classList.add('fa-bars');
    });

    // Logout confirmation modal behavior
    (function() {
        const modal = document.getElementById('logoutModal');
        const cancelBtn = document.getElementById('cancelLogout');
        const confirmBtn = document.getElementById('confirmLogout');
        let pendingLogoutUrl = null;

        function openModal(url) {
            pendingLogoutUrl = url;
            if (modal) {
                modal.classList.remove('hidden');
            }
        }

        function closeModal() {
            pendingLogoutUrl = null;
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        document.addEventListener('click', function(e) {
            const target = e.target.closest('.logout-trigger');
            if (!target) return;
            e.preventDefault();
            openModal(target.getAttribute('href'));
        });

        if (cancelBtn) {
            cancelBtn.addEventListener('click', function() {
                closeModal();
            });
        }

        if (confirmBtn) {
            confirmBtn.addEventListener('click', function() {
                if (pendingLogoutUrl) {
                    window.location.href = pendingLogoutUrl;
                }
            });
        }

        const backdrop = document.querySelector('.logout-modal-backdrop');
        if (backdrop) {
            backdrop.addEventListener('click', function() {
                closeModal();
            });
        }
    })();
</script>